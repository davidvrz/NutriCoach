{% extends "base.html" %}

{% block title %}Dashboard {{ cliente.nombre }} - NutriCoach{% endblock %}

{% block content %}
<div class="secondary-nav">
    <div class="breadcrumb">
        <span class="breadcrumb-item"><a href="{{ url_for('cliente.lista_clientes') }}">Clientes</a></span>
        <span class="breadcrumb-item">{{ cliente.nombre }}</span>
    </div>
</div>

<h1>Seguimiento de {{ cliente.nombre }}</h1>

<div class="dashboard-actions">
    <a href="{{ url_for('plan.lista_planes_predefinidos') }}" class="btn-secondary">
        <i class="icon-template"></i> Planes predefinidos
    </a>
</div>

<div class="card">
    <div class="cliente-header">
        <h2 class="card-title">Informaci칩n del cliente</h2>
        <a href="{{ url_for('cliente.editar_cliente', cliente_email=cliente.email) }}" class="btn-editar">Editar
            datos</a>
    </div>
    <p><strong>Objetivo:</strong> {{ cliente.objetivo }}</p>
    <p><strong>Edad:</strong> {{ cliente.edad }} a침os</p>
    <p><strong>Peso:</strong> {{ cliente.peso }} kg</p>
    <p><strong>Altura:</strong> {{ cliente.altura }} cm</p>
</div>

<div class="semanas-timeline">
    <h2>Cronograma de semanas nutricionales</h2>

    <div class="timeline-actions">
        <a href="{{ url_for('semana.nueva_semana', cliente_email=cliente.email) }}" class="btn-primary">+ Crear nueva
            semana</a>
    </div>

    {% if semanas %}
    <div class="timeline-wrapper">
        <div class="timeline-line"></div>
        <div class="timeline-container">
            {% for s in semanas %}
            {% set semana = s.semana %}
            {% set safe_id = s.safe_id %}
            {% set index = loop.index %}
            {% set today = now.date() %}
            {% set is_current = semana.fecha_inicio <= today and today <=semana.fecha_fin %} <div
                class="timeline-card {% if is_current %}current{% endif %}">
                <div class="timeline-dot"></div>
                <div class="timeline-card-header">
                    <div class="timeline-date">{{ semana.fecha_inicio.strftime("%d/%m") }} - {{
                        semana.fecha_fin.strftime("%d/%m") }}</div>
                    <div class="timeline-estado">{{ semana.estado_general }}</div>
                </div>
                <div class="timeline-card-content">
                    <div class="timeline-card-actions">
                        <a href="{{ url_for('semana.ver_semana', cliente_email=cliente.email, safe_id=safe_id) }}"
                            class="btn-ver-semana">Ver semana completa</a>
                    </div>
                </div>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="timeline-empty">
    <p>No hay semanas de seguimiento a칰n. Crea una nueva semana para comenzar el seguimiento nutricional.</p>
</div>
{% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .cliente-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }

    .btn-editar {
        background-color: var(--accent-color);
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
    }

    .btn-editar:hover {
        background-color: #0288d1;
    }

    /* Timeline de semanas */
    .semanas-timeline {
        margin-top: 30px;
    }

    .semanas-timeline h2 {
        margin-bottom: 20px;
        color: var(--primary-color);
    }

    .timeline-wrapper {
        position: relative;
        padding: 50px 0 30px;
        /* Aumentado el margen superior */
        overflow-x: auto;
        margin-bottom: 20px;
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) #f0f0f0;
    }

    .timeline-wrapper::-webkit-scrollbar {
        height: 8px;
    }

    .timeline-wrapper::-webkit-scrollbar-track {
        background: #f0f0f0;
        border-radius: 10px;
    }

    .timeline-wrapper::-webkit-scrollbar-thumb {
        background-color: var(--primary-color);
        border-radius: 10px;
        border: 2px solid #f0f0f0;
    }

    .timeline-line {
        position: absolute;
        top: 100px;
        /* Aumentado para dar m치s espacio */
        left: 0;
        height: 4px;
        background-color: #ddd;
        width: 100%;
        z-index: 1;
    }

    .timeline-container {
        display: flex;
        flex-direction: row-reverse;
        gap: 30px;
        position: relative;
        min-width: min-content;
        padding: 0 15px;
        width: max-content;
    }

    .timeline-card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        width: 250px;
        flex-shrink: 0;
        position: relative;
        z-index: 2;
    }

    .timeline-card.current {
        width: 280px;
        border: 3px solid var(--primary-color);
        /* Borde m치s grueso del color de la app */
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
        /* Sombra con el color de la app */
    }

    .timeline-dot {
        position: absolute;
        top: -25px;
        /* Ajustado para dar m치s espacio */
        left: 50%;
        transform: translateX(-50%);
        width: 16px;
        height: 16px;
        background-color: var(--primary-color);
        border-radius: 50%;
        border: 3px solid white;
    }

    .timeline-card-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px 20px;
        background-color: #f9f9f9;
        border-bottom: 1px solid #eee;
        position: relative;
    }

    .timeline-date {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 5px;
        text-align: center;
    }

    .timeline-estado {
        color: #666;
        font-size: 0.9rem;
        text-align: center;
    }

    .timeline-card-content {
        padding: 15px;
        text-align: center;
    }

    .timeline-card-actions {
        text-align: center;
    }

    .btn-ver-semana {
        background-color: var(--primary-color);
        color: white;
        padding: 8px 15px;
        border-radius: 4px;
        text-decoration: none;
        display: inline-block;
        font-size: 0.9rem;
    }

    .btn-ver-semana:hover {
        opacity: 0.9;
        text-decoration: none;
        color: white;
    }

    .dashboard-actions {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 20px;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
        padding: 8px 15px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
        text-decoration: none;
        color: white;
    }

    .icon-template::before {
        content: "游늶";
        font-size: 16px;
    }

    @media (max-width: 768px) {
        .timeline-card {
            width: 200px;
        }

        .timeline-card.current {
            width: 230px;
        }
    }
</style>
{% endblock %}